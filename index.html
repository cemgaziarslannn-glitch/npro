<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Denetleme Sistemi | GiriÅŸ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;800&display=swap" rel="stylesheet">
<link rel="manifest" href="./manifest.json">

<style>
body{
  margin:0;
  font-family:Inter,sans-serif;
  background:radial-gradient(circle at top,#1e3a8a,#020617);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card{
  width:100%;
  max-width:380px;
  padding:26px;
  border-radius:26px;
  background:rgba(15,23,42,.7);
  text-align:center;
}
.lock{font-size:48px;margin-bottom:12px}
.lock.locking{animation:shake .6s ease-in-out 2}
@keyframes shake{
  0%{transform:rotate(15deg)}
  25%{transform:rotate(-15deg)}
  50%{transform:rotate(15deg)}
  75%{transform:rotate(-15deg)}
  100%{transform:rotate(0)}
}
input{
  width:100%;
  padding:15px;
  margin-top:14px;
  border-radius:16px;
  background:#020617;
  border:1px solid #334155;
  color:#fff;
}
button{
  width:100%;
  margin-top:22px;
  padding:16px;
  border:none;
  border-radius:18px;
  background:linear-gradient(135deg,#38bdf8,#6366f1);
  font-weight:800;
}
.fake{
  margin-top:14px;
  padding:14px;
  border-radius:14px;
  background:#020617;
  border:1px solid #334155;
  color:#94a3b8;
}
.message{margin-top:16px;font-weight:700}
.message.error{color:#ff6b6b}
.message.success{color:#22c55e}
</style>
</head>

<body>

<div class="card">
  <div id="lock" class="lock">ğŸ”</div>
  <h2 id="title">GÃ¼venli GiriÅŸ</h2>

  <!-- INPUT ALANI -->
  <div id="loginInputs">
    <input id="email" type="email" placeholder="E-posta">
    <input id="password" type="password" placeholder="Åifre">
  </div>

  <!-- OTOMATÄ°K OTURUM ALANI -->
  <div id="autoArea" style="display:none">
    <div class="fake" id="userName"></div>
    <div class="fake">ğŸ”’ GÃ¼venli oturum aÃ§Ä±lÄ±yor</div>
    <div class="fake">ğŸ›¡ï¸ Kimlik doÄŸrulandÄ±</div>
  </div>

  <button onclick="login()">GiriÅŸ Yap</button>
  <div id="msg" class="message"></div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCye0QlekBFonTxfeBIlhLc9ia-mleyfUM",
  authDomain:"denetleme-4d3d9.firebaseapp.com",
  databaseURL:"https://denetleme-4d3d9-default-rtdb.firebaseio.com",
  projectId:"denetleme-4d3d9",
  appId:"1:584625735764:web:5889dcaadb69c4c78f45c1"
});

const email=document.getElementById("email");
const pass=document.getElementById("password");
const msg=document.getElementById("msg");
const lock=document.getElementById("lock");
const loginInputs=document.getElementById("loginInputs");
const autoArea=document.getElementById("autoArea");
const userName=document.getElementById("userName");

function show(t,type="error"){
  msg.textContent=t;
  msg.className="message "+type;
}

/* SAYFA AÃ‡ILINCA */
firebase.auth().onAuthStateChanged(u=>{
  if(!u) return;

  firebase.database().ref("users/"+u.uid).once("value").then(s=>{
    if(!s.exists()) return;

    loginInputs.style.display="none";
    autoArea.style.display="block";
    userName.textContent="ğŸ‘¤ "+s.val().name;
  });
});

function login(){
  const u=firebase.auth().currentUser;

  if(u){
    // otomatik giriÅŸ
    proceed(u);
    return;
  }

  if(!email.value || !pass.value){
    show("E-posta ve ÅŸifre giriniz");
    return;
  }

  firebase.auth().signInWithEmailAndPassword(email.value,pass.value)
    .then(r=>proceed(r.user))
    .catch(()=>{
      lock.classList.add("locking");
      show("E-posta veya ÅŸifre hatalÄ±");
    });
}

function proceed(user){
  firebase.database().ref("users/"+user.uid).once("value").then(s=>{
    if(!s.exists()){
      show("Yetki yok");
      return;
    }
    lock.textContent="âœ”ï¸";
    lock.style.color="#22c55e";
    show("GiriÅŸ baÅŸarÄ±lÄ±","success");
    setTimeout(()=>{
      location.replace(s.val().role==="admin"?"tekadmin.html":"menÃ¼.html");
    },600);
  });
}
</script>

</body>
</html>
